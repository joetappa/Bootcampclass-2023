# docker Volumes(Storage): 
==============================
Docker volumes are a crucial part of Docker's containerization technology, allowing for persistent data storage and sharing between containers. 

## 1. Types of Docker Volumes(storage)

**Bind Mounts:** 
    - Bind Mounts Map a specific file or directory on the host machine to a container. Unlike volumes, bind mounts are dependent on the filesystem of the host machine.

**Persistent Volume**
   - Docker volumes are a mechanism to persist data generated by and used by Docker containers. They are stored in a part of the host filesystem managed by Docker (`/var/lib/docker/volumes/`) on Linux.
   - Volumes are completely managed by Docker and are isolated from the core functionality of the host machine.


## 2. Benefits of Using Volumes:

   - **Data Persistence:** Data in volumes persists beyond the life of a single container.
   - **Data Sharing:** Volumes can be shared or reused among multiple containers.
   - **Data Security:** Using volumes can enhance the security of sensitive data.

## 3. Use Cases: 
   - Storing database files to persist database state.
   - Sharing configuration files between the host and containers.
   - Providing a storage mechanism for logs and other files that need to be persisted or analyzed outside of the container.

## 4. **Advanced Features:**
   - Docker also supports volume drivers, which allow you to store volumes on remote hosts or cloud providers.
   - Volume plugins can be used to extend the capabilities of Docker volumes, providing features like encryption or compression.

## 5. Docker Volume Commands: 
  **create**      Create a volume
  **inspect**     Display detailed information on one or more volumes
  **ls**          List volumes
  **prune**       Remove unused local volumes
  **rm**          Remove one or more volumes


### 1. ls - List volumes
  
-  **How to list volumes in docker?**
```Docker 
docker volume ls
```
Outcome: 
ubuntu@docker:~$ docker network ls
DRIVER    VOLUME NAME
local     3bcdfb06f833d83869ed33f8e330dd3cbffd6c172220a054160db8543
local     gg867644bd51c46e4c37cc93c1d71c9d278c73179855e939c82beb222
local     spring-boot-mongo-docker_data

## 2. create - Create a volume
  
  Types of volume  
  - Bind Mounts  
  - Peristent

    ### 2a. Bind Mounts:
Bind mounts may stored data anywhere on the host system. 
They may even be important system files or directories. 

NB:We need to understand what a Stateful ans stateless applications. 

Stateful Applications:
A stateful application is one that saves client information or data over multiple requests. 

Stateless Applications:
A stateless application does not save any information or data between requests. 

**How to add bind mount in docker?**  
- Requirement : 
Stateful application : mongo
Host mount point : /tmp/mongodb
Container mount point : /data/db

BindMount:
  /tmp/mongo:/data/db
  /home/ubuntu/data:/data/db

**deploying BindMount**
docker run --name mongo -d --network spring-network \
    -v /tmp/mongo:/data/db \
    -e MONGO_INITDB_ROOT_PASSWORD=admin123 \
    -e MONGO_INITDB_ROOT_USERNAME=root mongo 

ubuntu@docker$: ls - /tmp/mongo
result: 

**Disadvantages** 
Non-Docker processes on the Docker host or a 
Docker container can modify them at any time.

### 2b. Docker Peristent Volumes

Volumes stored data in a part of the host filesystem managed by docker
Docker Home Directory (DHD) on host machine 
DHD = /var/lib/docker
Host mount point : /var/lib/docker/volumes/data

Example 1
`docker volume create mongodata`  ---- default driver local  
`docker volume ls` 

outcome: 
DRIVER    VOLUME NAME
local     7f769ae3bcdfb06f833d83869ed330dd3cbffd6c172220a054160db8543
local     c20de32eb867644bd51c46e4c371d71c9d278c73179855e939c82beb222
local     spring-boot-mongo-docker_data
local     mongodata 

Example 2
`docker volume create -d local data` 
`docker volume ls` 

outcome: 
DRIVER    VOLUME NAME
local     7f769ae3bcdfb06f833d83869ed330dd3cbffd6c172220a054160db8543
local     c20de32eb867644bd51c46e4c371d71c9d278c73179855e939c82beb222
local     spring-boot-mongo-docker_data
local     mongodata
local     data

`docker volume inspect data` 
result :

**deploying peristent volume**
docker run --name mongo -d --network sringboot-network  \
  -v data:/data/db \
  -e MONGO_INITDB_ROOT_PASSWORD=admin123 \
  -e MONGO_INITDB_ROOT_USERNAME=root mongo 

docker run --name mongo -d --network tesla \
  -v mongodata:/data/db \
  -e MONGO_INITDB_ROOT_PASSWORD=admin123 \
  -e MONGO_INITDB_ROOT_USERNAME=root mongo 

docker volume rm data 

Volumes are the best way to persist data in Docker.:    

### 2c. External Volumes

 **Requirement** : 
External storage application : AWS - EBS/EFS/S3FS , Azure Disk , GCE
Plugin : Rexray docker-plugins for storage
external mount point : ebs
Container mount point : /data/db
 
 Installation guide : https://rexray.readthedocs.io/en/v0.8.2/user-guide/docker-plugins/ 

 Create IAM User with EC2 Full Access and user access key & Secret Key of the same. 
 Replace your access key & secret below.

Note: We are authorizing Docker to create volumes in AWS 

**install plugins**
  docker plugin install rexray/ebs \
  EBS_ACCESSKEY="accesskey" \
  EBS_SECRETKEY="secret"

`docker plugin ls` 

docker volume create -d rexray/ebs ebs30
docker volume create -d local ebs40

**External volume on AWS**  
Go AWS EC2 Dashboard 
---> Volumes
Check for ebs30 volume and check its avaliablity 

**Deploy the mongoDB container using external volumes:**

docker run --name mongo -d --network spring-network \
  -v ebs30:/data/db \
  -e MONGO_INITDB_ROOT_PASSWORD=admin123 \
  -e MONGO_INITDB_ROOT_USERNAME=root mongo 


**Read/write Options of volumes**
By default volumes are mounted as Read/Write

We can map Volumes As Read Only using below option
   -v <volumeName/BindMount>:<containerPath>:ro


